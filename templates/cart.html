{% extends 'base.html' %}
{% load static %}
{% block pics %}{% endblock %}

{% block content %}
<div class="container pt-5">
    <h2>Your Cart</h2>
    <table class="table table-bordered mt-3">
        <thead>
            <tr>
                <th>Item</th>
                <th>Price (₹)</th>
                <th>Quantity</th>
                <th>Total (₹)</th>
            </tr>
        </thead>
        <tbody id="cart-items"></tbody>
        <tfoot>
            <tr>
                <th colspan="3">Grand Total</th>
                <th id="grand-total">0</th>
            </tr>
        </tfoot>
    </table>
    <button class="btn btn-success" onclick="checkout()">Checkout</button>
</div>

<script>
function loadCart(){
    const cart = JSON.parse(localStorage.getItem('cart')) || [];
    const tbody = document.getElementById('cart-items');
    tbody.innerHTML = '';
    let grandTotal = 0;

    cart.forEach(item => {
        const price = Number(item.price); // ensure numeric
        const qty = Number(item.quantity); // ensure numeric
        const total = price * qty;
        grandTotal += total;

        const row = document.createElement('tr');
        row.innerHTML = `
            <td>${item.name}</td>
            <td>₹${price.toFixed(2)}</td>
            <td>${qty}</td>
            <td>₹${total.toFixed(2)}</td>
        `;
        tbody.appendChild(row);
    });

    document.getElementById('grand-total').textContent = `₹${grandTotal.toFixed(2)}`;
}

function checkout(){
    alert('Thank you! Proceeding to checkout.');
    localStorage.removeItem('cart'); // clear cart
    window.location.href = '/'; // back to menu
}

// Run after page fully loads
window.addEventListener('DOMContentLoaded', loadCart);
</script>
{% endblock %}
